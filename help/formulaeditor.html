<!DOCTYPE html>
<html lang="en">
	<head>
		<meta name="viewport" content="initial-scale=1.0">
		<link rel="stylesheet" href="help.css" type="text/css">
		<script type="text/javascript" src="help.js"></script>
		<script type="text/javascript">
			window.onload = () => {
				rtSetupHeading('Formula Editor',{
					fields: 'Formula Fields',
					editor: 'Formula Editor',
					preview: 'Previews and Completions',
					import: 'Import File',
					spacing: 'Multiple Lines and Tabs',
					buttons: "Buttons",
					ubrowser: 'Unit Browser',
					fbrowser: 'Function Browser',
				});
			};			
		</script>	
		<title>Formula Editor</title>
	</head>
	
	<body>
		<div id="page">
			<div id="heading"></div>
			<div id="menubody"></div>
			<div id="fields" class="section">
				<h3>Formula Fields</h3>
				<p>
					All information views for <a href="tools.html">tools</a> have one or more
					<a href="formula.html">formula</a> fields, like this:
				</p>
				<img src="formulafield.png" alt="a formula field"/>
				<p>
					You can tap in this field and enter or edit the formula directly. Once you hit the return
					key or leave the field, the new formula will be applied and new results calculated as needed.
				</p>
				<p>
					These fields can be identified by the equal sign in front of them. Tapping on the equal
					sign will cause the value calculated by the formula to be forgotten and recalculated.  This
					normally isn't necessary as Math Minion will forget and recalculate tools whenever one of
					their inputs is modified.
				</p>
				<p>
					Directly editing a formula field is fine for simple one line formulas, but for more
					complex formulas or where you would like help with units or functions, you should
					invoke the formula editor. This is done by either typing
					shift-enter while editing the field or by tapping the <b>&#10530;</b> icon to its right.
				</p>
			</div>
			<div id="editor" class="section">
				<h3>Formula Editor</h3>
				<p>
					The formula editor consists of a text area where the formula is
					entered or modified, along with a number of buttons and a preview area.
				</p>
				<img src="formulaedit.png" alt="formula editor"/>
				<p>
					You can drag on the up/down icon <b>&#8597;</b> to the right of the <b>Apply</b>
					button to adjust the relative sizes of the input and preview areas.
				</p>
				<div id="preview" class="section">
					<h3>Previews &amp; Completions</h3>
					<p>
						When the formula editor appears, the current formula, if any, will appear in the text area
						with any cursor position or selection from the formula field maintained. What appears in
						the preview area will depend on the cursor position and the formula.
					</p>
					<p>
						If the cursor is in a position where it appears a reference to another tool might be
						appropriate, as in the case above where the formula is blank, then a list of available
						tools appears in the preview area. In this case, the expression has been created in the
						tools.models.circle model of the Getting Started session and the values represent its tools.
					</p>
					<p>
						If there are characters in front of the cursor, the list will be reduced to items starting
						with those characters.
					</p>
					<img src="formulaedit2.png" alt="reduced parameter preview"/>
					<p>
						Tapping on a element in the preview area will insert it into the formula. You can also type
						a tab character or a period to insert the top element of the list, as long as at least one
						character has already been typed.
					</p>
					<p>
						If the cursor is preceded by a brace, <b>{</b>, then all the available functions are listed
						in the preview area, with the list being reduced as additional characters are entered.
					</p>
					<img src="formulaedit3.png" alt="function preview"/>
					<p>
						Tapping on an element of the preview list, or typing a tab character, will insert the
						function in the formula and place the cursor before the first argument.
					</p>
					<img src="formulaedit4.png" alt="inserted function"/>
					<p>
						If the cursor is preceded by a ?, white space and the function name, then a brief
						description of the function and its arguments will appear in the preview area.
					</p>
					<img src="formulaedit5.png" alt="function description"/>
					<p>
						If the cursor is preceded by a value name and a dot, then the available parameters
						for that value are listed in the preview area.
					</p>
					<img src="formulaedit6.png" alt="dot parameter preview"/>
					<p>
						When the cursor appears to be where a conversion unit is appropriate, a list of
						match units are displayed in the preview area.
					</p>
					<img src="formulaedit7.png" alt="unit preview"/>
					<p>
						If the cursor isn't preceded by something where a suggestion in appropriate, then the
						preview area will show the last previewed calculation value. Initially this will be the
						value of the original formula before editing. 
					</p>
					<img src="formulaedit8.png" alt="area value preview"/>
					<p>
						Here the cursor is at the end of the formula for area in that circle model and a value
						reference or function call would not be appropriate.
					</p>
					<p>
						As you enter or edit the formula, you can tap the Preview Button or type ctrl-enter to
						evaluate the current (edited) formula in the preview area regardless of the cursor position.
						If you select only a part of the formula before previewing, only the selected portion
						will be evaluated. This is a handy way to debug complicated formulas.
					</p>
					<p>
						Tapping the <b>Current</b> button or type alt-enter (option-enter on a Mac), will
						preview the original unedited formula.
					</p>
				</div>
				<div id="import" class="section">
					<h3>Import File</h3>
					<p>
						A formula starting with a single quote means the rest
						of the formula will be a text string and sometimes you might
						want to get that text from and existing file.
					</p>
					<p>
						So when the formula consists of just a single quote, the
						<b>Preview</b> button becomes an <b>Import File</b> button. Tapping it
						will present a file browser where you can select a text file to import.
						The resulting formula will be a single quote followed by the contents of
						the file.
					</p>
				</div>
				<div id="spacing" class="section">
					<h3>Multiple Lines and Tabs</h3>
					<p>
						In more complex formulas and with some functions, it is common to space the formula out
						over multiple lines and use tabs to improve the readability. There are a couple of features
						to assist with this.
					</p>
					<p>
						When you add a new line to an already indented line, the editor will automatically match
						the indentation.
					</p>
					<p>
						You can increase or decrease the indentation of by selecting multiple lines and then typing
						<b>tab</b> or <b>shift-tab</b> respectively.
					</p>
				</div>
				<div id="buttons" class="section">
					<h3>Buttons</h3>
					<p>
						There are a number of buttons in addition to <b>Preview</b> and <b>Current</b>.
					</p>
					<p>
						The <b>Cancel</b> button (escape key) will exit the formula editor without
						saving any of the changes. The <b>Apply</b> button <b>(shift-enter)</b> will exit the
						formula editor and any exit other than cancelling will assign the changes to the formula.
					</p>
					<p>
						The <b>Units</b> and <b>Functions</b> buttons open browsers for conversion units and
						functions respectively.
					</p>
				</div>
				<div id="ubrowser" class="section">
					<h3>Units Browser (ctrl-u)</h3>
					<p>	
						Presents a view where you can select from the available <a href="units.html">units</a>.
						The left pane contains the defined types and selecting one of those will fill the right
						pane with the units that are defined for that type.
					</p>
					<p>
						In the image below, the type <b>Area</b> has been selected and then <b>hectare</b> was
						selected from the right pane.  This places the selected unit in the input field.
					</p>
					<img src="unitbrowser.png" alt="value browser"/>
					<p>
						Tapping the <b>Apply</b> button will insert the unit into the formula, enclosed in double
						quotes if it contains <b></b>, <b>/</b> or <b>^</b>.
					</p>
					<p>
						You aren't limited to the units listed and can create your own by combining existing
						units in the input field, either by typing them in directly, or by selecting
						them from the lists.  If you add a <b>-</b> or <b>/</b> operator to the end of the input
						field, selecting another unit will result in it being appended, rather than replacing the
						existing selection.
					</p>
					<p>
						If you need to define a completely new base unit, see custom units on the
						<a href="units.html">units</a> help page.
					</p>
					<p>
						This browser is also used for selecting display units for
						<a href="expression.html">expressions</a>,
						<a href="matrix.html">matrices</a>,
						<a href="datatable.html">data tables</a> and
						<a href="graph.html">graphs</a>.						
					</p>
				</div>
				<div id="fbrowser" class="section">
					<h3>Function Browser - (ctrl-f)</h3>
					<p>
						While the preview area is handy for entering functions, sometimes you will want
						to browse the functions and descriptions by category to see what is available. 
						This is what the function browser does and as you can see in the image below,
						it has what are hopefully pretty clear instructions on how to use it.
					</p>
					<p>
						In this case the section for trigonometric functions has been selected and then the
						sine function within it.
					</p>
					<img src="funcbrowser.png" alt="value browser"/>
				</div>
			</div>
		</div>
	</body>
</html>
